<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ficha Técnica Digital - MVP</title>
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #64748b;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --border-color: #e2e8f0;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid var(--border-color);
            text-align: center;
        }

        .header h1 {
            color: var(--primary-color);
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .tabs {
            display: flex;
            background: var(--card-bg);
            border-radius: 12px;
            padding: 8px;
            margin-bottom: 24px;
            border: 1px solid var(--border-color);
            gap: 8px;
        }

        .tab {
            flex: 1;
            padding: 12px 20px;
            background: transparent;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
            color: var(--text-secondary);
        }

        .tab.active {
            background: var(--primary-color);
            color: white;
            transform: translateY(-1px);
        }

        .tab:hover:not(.active) {
            background: var(--bg-color);
            color: var(--text-primary);
        }

        .section {
            display: none;
            background: var(--card-bg);
            border-radius: 12px;
            padding: 32px;
            border: 1px solid var(--border-color);
            margin-bottom: 24px;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 24px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--border-color);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-top: 8px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            background: white;
        }

        .checkbox-item:hover {
            border-color: var(--primary-color);
            background: rgba(37, 99, 235, 0.05);
        }

        .checkbox-item.selected {
            border-color: var(--primary-color);
            background: rgba(37, 99, 235, 0.1);
        }

        .checkbox-item input[type="checkbox"] {
            margin: 0;
            width: 16px;
            height: 16px;
        }

        .conditional-field {
            display: none;
            margin-top: 16px;
            padding: 16px;
            background: var(--bg-color);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .conditional-field.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { opacity: 0; max-height: 0; padding-top: 0; padding-bottom: 0; }
            to { opacity: 1; max-height: 200px; padding-top: 16px; padding-bottom: 16px; }
        }

        .input-with-other {
            display: flex;
            gap: 12px;
            align-items: flex-end;
        }

        .input-with-other select {
            flex: 1;
        }

        .input-with-other input[type="text"] {
            flex: 1;
            display: none;
        }

        .input-with-other input[type="text"].show {
            display: block;
        }

        /* Acionamentos dinâmicos */
        .acionamento-container {
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            background: white;
            transition: all 0.3s ease;
        }

        .acionamento-container:hover {
            border-color: var(--primary-color);
            box-shadow: 0 2px 8px rgba(37, 99, 235, 0.1);
        }

        .acionamento-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-color);
        }

        .acionamento-number {
            background: var(--primary-color);
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .acionamentos-dynamic {
            display: none;
        }

        .acionamentos-dynamic.show {
            display: block;
            animation: fadeIn 0.4s ease;
        }

        .conditional-motor {
            display: none;
            padding: 16px;
            background: rgba(37, 99, 235, 0.05);
            border-radius: 8px;
            margin-top: 16px;
            border-left: 4px solid var(--primary-color);
        }

        .conditional-hydraulic {
            display: none;
            padding: 16px;
            background: rgba(16, 185, 129, 0.05);
            border-radius: 8px;
            margin-top: 16px;
            border-left: 4px solid var(--success-color);
        }

        .conditional-motor.show,
        .conditional-hydraulic.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        .acionamento-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .acionamento-grid .form-group.full-width {
            grid-column: 1 / -1;
        }

        /* Dispositivos com checkbox + quantidade + observação */
        .device-group {
            margin-bottom: 32px;
        }

        .device-group h4 {
            color: var(--primary-color);
            font-size: 1.2rem;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .device-item {
            display: grid;
            grid-template-columns: auto 1fr 120px 200px;
            gap: 12px;
            align-items: center;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 8px;
            background: white;
            transition: all 0.2s ease;
        }

        .device-item:hover {
            border-color: var(--primary-color);
            background: rgba(37, 99, 235, 0.02);
        }

        .device-item.active {
            border-color: var(--success-color);
            background: rgba(16, 185, 129, 0.05);
        }

        .device-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .device-label {
            font-weight: 500;
            cursor: pointer;
            color: var(--text-primary);
        }

        .device-quantity {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            width: 100%;
            font-size: 0.9rem;
            opacity: 0.5;
            transition: all 0.2s ease;
        }

        .device-observation {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            width: 100%;
            font-size: 0.9rem;
            opacity: 0.5;
            transition: all 0.2s ease;
        }

        .device-item.active .device-quantity,
        .device-item.active .device-observation {
            opacity: 1 !important;
            border-color: var(--success-color) !important;
            pointer-events: auto !important;
            background: white !important;
            color: var(--text-primary) !important;
        }

        .device-item:not(.active) .device-quantity,
        .device-item:not(.active) .device-observation {
            pointer-events: none !important;
            background: #f8f9fa !important;
            color: #999 !important;
            opacity: 0.5 !important;
        }

        .device-item.active .device-quantity:focus,
        .device-item.active .device-observation:focus {
            outline: none;
            border-color: var(--success-color);
            box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.2);
        }

        /* Preview para dispositivos */
        .devices-preview-grid {
            display: grid;
            grid-template-columns: 1fr 80px 1fr;
            gap: 8px 16px;
            align-items: center;
        }

        .device-preview-item {
            display: contents;
        }

        label {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .required {
            color: var(--error-color);
        }

        input, select, textarea {
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.2s ease;
            background: white;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        input.error, select.error {
            border-color: var(--error-color);
        }

        .error-message {
            color: var(--error-color);
            font-size: 0.875rem;
            margin-top: 4px;
            display: none;
        }

        .status-bar {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 16px 24px;
            margin-bottom: 24px;
            border: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .save-status {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .save-status.saved {
            color: var(--success-color);
        }

        .actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 32px;
            padding-top: 24px;
            border-top: 1px solid var(--border-color);
        }

        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: #1d4ed8;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: var(--bg-color);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: white;
            color: var(--text-primary);
        }

        /* Preview de impressão */
        .preview {
            display: none;
            background: white;
            max-width: 210mm;
            margin: 0 auto;
            padding: 20mm;
            border: 1px solid var(--border-color);
            border-radius: 8px;
        }

        .preview.active {
            display: block;
        }

        .preview h2 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 8px;
            margin-bottom: 20px;
        }

        .preview-section {
            margin-bottom: 24px;
        }

        .preview-section h3 {
            background: var(--bg-color);
            padding: 8px 12px;
            border-radius: 6px;
            margin-bottom: 12px;
            font-size: 1.1rem;
        }

        .preview-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 8px 16px;
            margin-bottom: 16px;
        }

        .preview-label {
            font-weight: 600;
            color: var(--text-secondary);
        }

        .preview-value {
            color: var(--text-primary);
        }

        @media print {
            body { 
                background: white; 
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            .container { max-width: none; padding: 0; }
            .header, .tabs, .status-bar, .actions { display: none; }
            .section { display: none; }
            .preview { 
                display: block; 
                border: none; 
                border-radius: 0;
                max-width: none;
                padding: 15mm;
            }
            
            /* Controle de quebras de página */
            .preview-section {
                page-break-inside: avoid; /* Evita quebra DENTRO da seção */
                break-inside: avoid;
                margin-bottom: 20px;
            }
            
            /* Se uma seção for muito longa, permite quebra apenas em pontos específicos */
            .preview-section h3 {
                page-break-after: avoid; /* Nunca quebra logo após o título */
                break-after: avoid;
                page-break-inside: avoid;
                break-inside: avoid;
            }
            
            /* Para acionamentos individuais */
            .acionamento-preview-item {
                page-break-inside: avoid; /* Evita quebra dentro de um acionamento */
                break-inside: avoid;
                margin-bottom: 12px;
            }
            
            /* Força nova página se necessário para seções grandes */
            .preview-section.force-new-page {
                page-break-before: always;
                break-before: page;
            }
            
            /* Evita páginas órfãs (menos de 3 linhas) */
            .preview-grid {
                orphans: 3;
                widows: 3;
            }
            
            /* Títulos sempre ficam com conteúdo */
            .preview-section h3 + .preview-grid,
            .preview-section h3 + div {
                page-break-before: avoid;
                break-before: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>📋 Ficha Técnica Digital</h1>
            <p>Sistema de geração de fichas técnicas profissionais</p>
        </div>

        <!-- Status Bar -->
        <div class="status-bar">
            <div class="save-status" id="saveStatus">
                <span>💾</span>
                <span id="saveText">Dados não salvos</span>
            </div>
            <div>
                <button class="btn btn-secondary" onclick="exportData()">📤 Exportar Dados</button>
                <button class="btn btn-secondary" onclick="importData()">📥 Importar Dados</button>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="showSection('consultor')">👤 Consultor</button>
            <button class="tab" onclick="showSection('cliente')">🏢 Cliente</button>
            <button class="tab" onclick="showSection('maquina')">⚙️ Máquina</button>
            <button class="tab" onclick="showSection('acionamentos')">🔧 Acionamentos</button>
            <button class="tab" onclick="showSection('seguranca')">🛡️ Segurança</button>
            <button class="tab" onclick="showSection('automacao')">🤖 Automação</button>
            <button class="tab" onclick="showSection('preview')">📄 Visualizar</button>
        </div>

        <!-- Seção: Dados do Consultor -->
        <div class="section active" id="consultor">
            <h2 class="section-title">
                <span>👤</span>
                <span>Dados do Consultor</span>
            </h2>
            
            <div class="form-grid">
                <div class="form-group">
                    <label for="consultorNome">
                        Nome Completo <span class="required">*</span>
                    </label>
                    <input type="text" id="consultorNome" required>
                    <div class="error-message">Nome é obrigatório</div>
                </div>
                
                <div class="form-group">
                    <label for="consultorTelefone">Telefone</label>
                    <input type="tel" id="consultorTelefone" placeholder="(00) 00000-0000">
                    <div class="error-message">Formato inválido</div>
                </div>
                
                <div class="form-group full-width">
                    <label for="consultorEmail">Email Profissional</label>
                    <input type="email" id="consultorEmail">
                    <div class="error-message">Email inválido</div>
                </div>
            </div>
        </div>

        <!-- Seção: Dados do Cliente -->
        <div class="section" id="cliente">
            <h2 class="section-title">
                <span>🏢</span>
                <span>Dados do Cliente</span>
            </h2>
            
            <div class="form-grid">
                <div class="form-group">
                    <label for="clienteNome">
                        Nome da Empresa <span class="required">*</span>
                    </label>
                    <input type="text" id="clienteNome" required>
                    <div class="error-message">Nome da empresa é obrigatório</div>
                </div>
                
                <div class="form-group">
                    <label for="clienteCidade">Cidade</label>
                    <input type="text" id="clienteCidade" placeholder="Cidade - Estado">
                </div>
                
                <div class="form-group">
                    <label for="clienteContato">Contato Técnico / Setor</label>
                    <input type="text" id="clienteContato">
                </div>
                
                <div class="form-group">
                    <label for="clienteSegmento">Segmento</label>
                    <input type="text" id="clienteSegmento" placeholder="ex: Metalurgia, Automobilística">
                </div>
                
                <div class="form-group">
                    <label for="clienteTelefone">Telefone</label>
                    <input type="tel" id="clienteTelefone" placeholder="(00) 0000-0000">
                </div>
                
                <div class="form-group">
                    <label for="clienteHorario">Horário de Trabalho</label>
                    <input type="text" id="clienteHorario" placeholder="08:00 - 18:00">
                </div>
                
                <div class="form-group">
                    <label for="clienteEmail">Email</label>
                    <input type="email" id="clienteEmail">
                </div>
                
                <div class="form-group">
                    <label for="clienteTurnos">Turnos</label>
                    <select id="clienteTurnos">
                        <option value="">Selecione...</option>
                        <option value="1">1 turno</option>
                        <option value="2">2 turnos</option>
                        <option value="3">3 turnos</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Seção: Dados da Máquina -->
        <div class="section" id="maquina">
            <h2 class="section-title">
                <span>⚙️</span>
                <span>Dados da Máquina</span>
            </h2>
            
            <div class="form-grid">
                <!-- Nome da Máquina / TAG -->
                <div class="form-group full-width">
                    <label for="maquinaNome">
                        Nome da Máquina / TAG <span class="required">*</span>
                    </label>
                    <input type="text" id="maquinaNome" required placeholder="Ex: Prensa Hidráulica - TAG001">
                    <div class="error-message">Nome da máquina é obrigatório</div>
                </div>

                <!-- Tipo de Dispositivo (múltipla escolha) -->
                <div class="form-group full-width">
                    <label>Tipo de Dispositivo</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="tipoNovo" value="Novo">
                            <label for="tipoNovo">Novo</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="tipoRetrofit" value="Retrofit">
                            <label for="tipoRetrofit">Retrofit</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="tipoAdequacao" value="Adequação NR10/NR12">
                            <label for="tipoAdequacao">Adequação NR10/NR12</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="tipoAutomacao" value="Automação">
                            <label for="tipoAutomacao">Automação</label>
                        </div>
                    </div>
                </div>

                <!-- Tensão de Entrada -->
                <div class="form-group">
                    <label for="tensaoEntrada">Tensão de Entrada</label>
                    <div class="input-with-other">
                        <select id="tensaoEntrada">
                            <option value="">Selecione...</option>
                            <option value="110V">110V</option>
                            <option value="220V">220V</option>
                            <option value="380V">380V</option>
                            <option value="440V">440V</option>
                            <option value="outro">Outro</option>
                        </select>
                        <input type="text" id="tensaoEntradaOutro" placeholder="Especificar tensão">
                    </div>
                </div>

                <!-- Fase -->
                <div class="form-group">
                    <label for="fase">Fase</label>
                    <select id="fase">
                        <option value="">Selecione...</option>
                        <option value="Monofásico">Monofásico</option>
                        <option value="Trifásico">Trifásico</option>
                    </select>
                </div>

                <!-- Neutro -->
                <div class="form-group">
                    <label for="neutro">Neutro</label>
                    <select id="neutro">
                        <option value="">Selecione...</option>
                        <option value="Sim">Sim</option>
                        <option value="Não">Não</option>
                    </select>
                </div>

                <!-- Tensão de Comando -->
                <div class="form-group">
                    <label for="tensaoComando">Tensão de Comando</label>
                    <div class="input-with-other">
                        <select id="tensaoComando">
                            <option value="">Selecione...</option>
                            <option value="24Vcc">24Vcc</option>
                            <option value="24Vca">24Vca</option>
                            <option value="110Vca">110Vca</option>
                            <option value="220Vca">220Vca</option>
                            <option value="outro">Outro</option>
                        </select>
                        <input type="text" id="tensaoComandoOutro" placeholder="Especificar tensão">
                    </div>
                </div>

                <!-- Tipo de Controle -->
                <div class="form-group">
                    <label for="tipoControle">Tipo de Controle</label>
                    <select id="tipoControle">
                        <option value="">Selecione...</option>
                        <option value="Comando elétrico">Comando elétrico</option>
                        <option value="CLP">CLP</option>
                    </select>
                </div>

                <!-- Tipo de Painel (múltipla escolha) -->
                <div class="form-group full-width">
                    <label>Tipo de Painel</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="painelAco" value="Aço Carbono">
                            <label for="painelAco">Aço Carbono</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="painelABS" value="ABS">
                            <label for="painelABS">ABS</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="painelInox" value="Inox">
                            <label for="painelInox">Inox</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="painelOutro" value="outro">
                            <label for="painelOutro">Outro</label>
                        </div>
                    </div>
                    <div class="conditional-field" id="painelOutroField">
                        <div class="form-group">
                            <label for="painelOutroTexto">Especificar tipo de painel:</label>
                            <input type="text" id="painelOutroTexto" placeholder="Descreva o material do painel">
                        </div>
                    </div>
                </div>

                <!-- Abordagem (múltipla escolha) -->
                <div class="form-group full-width">
                    <label>Abordagem</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="abordagemAutomacao" value="Painel de Automação">
                            <label for="abordagemAutomacao">Painel de Automação</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="abordagemSeguranca" value="Painel de Segurança">
                            <label for="abordagemSeguranca">Painel de Segurança</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Seção: Acionamentos de Automação -->
        <div class="section" id="acionamentos">
            <h2 class="section-title">
                <span>🔧</span>
                <span>Acionamentos de Automação</span>
            </h2>
            
            <div class="form-grid">
                <!-- Número de Acionamentos -->
                <div class="form-group">
                    <label for="numAcionamentos">Número de Acionamentos</label>
                    <select id="numAcionamentos">
                        <option value="">Selecione...</option>
                        <option value="1">1 acionamento</option>
                        <option value="2">2 acionamentos</option>
                        <option value="3">3 acionamentos</option>
                        <option value="4">4 acionamentos</option>
                        <option value="5">5 acionamentos</option>
                    </select>
                </div>
            </div>

            <!-- Container dinâmico para acionamentos -->
            <div class="acionamentos-dynamic" id="acionamentosDynamic">
                <!-- Acionamentos serão inseridos aqui dinamicamente -->
            </div>
        </div>

        <!-- Seção: Dispositivos de Segurança -->
        <div class="section" id="seguranca">
            <h2 class="section-title">
                <span>🛡️</span>
                <span>Dispositivos de Segurança</span>
            </h2>

            <!-- Botões de Segurança -->
            <div class="device-group">
                <h4>🚨 Botões de Segurança</h4>
                
                <div class="device-item">
                    <input type="checkbox" class="device-checkbox" id="btnEmergencia" data-device="emergencia">
                    <label for="btnEmergencia" class="device-label">Botão de Emergência</label>
                    <input type="number" class="device-quantity" id="qtdEmergencia" placeholder="Qtd" min="0">
                    <input type="text" class="device-observation" id="obsEmergencia" placeholder="Observações">
                </div>

                <div class="device-item">
                    <input type="checkbox" class="device-checkbox" id="btnRearme" data-device="rearme">
                    <label for="btnRearme" class="device-label">Botão de Rearme</label>
                    <input type="number" class="device-quantity" id="qtdRearme" placeholder="Qtd" min="0">
                    <input type="text" class="device-observation" id="obsRearme" placeholder="Observações">
                </div>

                <div class="device-item">
                    <input type="checkbox" class="device-checkbox" id="btnHomemMorto" data-device="homemMorto">
                    <label for="btnHomemMorto" class="device-label">Botão Homem-Morto</label>
                    <input type="number" class="device-quantity" id="qtdHomemMorto" placeholder="Qtd" min="0">
                    <input type="text" class="device-observation" id="obsHomemMorto" placeholder="Observações">
                </div>

                <div class="device-item">
                    <input type="checkbox" class="device-checkbox" id="calcoSeguranca" data-device="calco">
                    <label for="calcoSeguranca" class="device-label">Calço de Segurança</label>
                    <input type="number" class="device-quantity" id="qtdCalco" placeholder="Qtd" min="0">
                    <input type="text" class="device-observation" id="obsCalco" placeholder="Observações">
                </div>

                <div class="device-item">
                    <input type="checkbox" class="device-checkbox" id="comandoBimanual" data-device="bimanual">
                    <label for="comandoBimanual" class="device-label">Comando Bi-manual</label>
                    <input type="number" class="device-quantity" id="qtdBimanual" placeholder="Qtd" min="0">
                    <input type="text" class="device-observation" id="obsBimanual" placeholder="Observações">
                </div>

                <div class="device-item">
                    <input type="checkbox" class="device-checkbox" id="pedaleiraSeguranca" data-device="pedaleira">
                    <label for="pedaleiraSeguranca" class="device-label">Pedaleira de Segurança</label>
                    <input type="number" class="device-quantity" id="qtdPedaleira" placeholder="Qtd" min="0">
                    <input type="text" class="device-observation" id="obsPedaleira" placeholder="Observações">
                </div>

                <div class="device-item">
                    <input type="checkbox" class="device-checkbox" id="tapeteSeguranca" data-device="tapete">
                    <label for="tapeteSeguranca" class="device-label">Tapete de Segurança</label>
                    <input type="number" class="device-quantity" id="qtdTapete" placeholder="Qtd" min="0">
                    <input type="text" class="device-observation" id="obsTapete" placeholder="Observações">
                </div>

                <div class="device-item">
                    <input type="checkbox" class="device-checkbox" id="sensorMagnetico" data-device="magnetico">
                    <label for="sensorMagnetico" class="device-label">Sensor Magnético</label>
                    <input type="number" class="device-quantity" id="qtdMagnetico" placeholder="Qtd" min="0">
                    <input type="text" class="device-observation" id="obsMagnetico" placeholder="Observações">
                </div>

                <div class="device-item">
                    <input type="checkbox" class="device-checkbox" id="cortinaLuz" data-device="cortina">
                    <label for="cortinaLuz" class="device-label">Cortina de Luz</label>
                    <input type="number" class="device-quantity" id="qtdCortina" placeholder="Qtd" min="0">
                    <input type="text" class="device-observation" id="obsCortina" placeholder="Observações">
                </div>

                <div class="device-item">
                    <input type="checkbox" class="device-checkbox" id="chaveBloqueio" data-device="chave">
                    <label for="chaveBloqueio" class="device-label">Chave de Bloqueio</label>
                    <input type="number" class="device-quantity" id="qtdChave" placeholder="Qtd" min="0">
                    <input type="text" class="device-observation" id="obsChave" placeholder="Observações">
                </div>

                <div class="device-item">
                    <input type="checkbox" class="device-checkbox" id="chaveTracao" data-device="tracao">
                    <label for="chaveTracao" class="device-label">Chave de Tração via Cabo</label>
                    <input type="number" class="device-quantity" id="qtdTracao" placeholder="Qtd" min="0">
                    <input type="text" class="device-observation" id="obsTracao" placeholder="Observações">
                </div>

                <div class="device-item">
                    <input type="checkbox" class="device-checkbox" id="scannerArea" data-device="scanner">
                    <label for="scannerArea" class="device-label">Scanner de Área</label>
                    <input type="number" class="device-quantity" id="qtdScanner" placeholder="Qtd" min="0">
                    <input type="text" class="device-observation" id="obsScanner" placeholder="Observações">
                </div>
            </div>

            <!-- Controladores do Sistema -->
            <div class="device-group">
                <h4>⚡ Controladores do Sistema</h4>

                <div class="device-item">
                    <input type="checkbox" class="device-checkbox" id="sc10" data-device="sc10">
                    <label for="sc10" class="device-label">SC10 (CLP de Segurança)</label>
                    <input type="number" class="device-quantity" id="qtdSC10" placeholder="Qtd" min="0">
                    <input type="text" class="device-observation" id="obsSC10" placeholder="Observações">
                </div>

                <div class="device-item">
                    <input type="checkbox" class="device-checkbox" id="sc26" data-device="sc26">
                    <label for="sc26" class="device-label">SC26 (CLP de Segurança)</label>
                    <input type="number" class="device-quantity" id="qtdSC26" placeholder="Qtd" min="0">
                    <input type="text" class="device-observation" id="obsSC26" placeholder="Observações">
                </div>

                <div class="device-item">
                    <input type="checkbox" class="device-checkbox" id="xs26" data-device="xs26">
                    <label for="xs26" class="device-label">XS26 (CLP de Segurança)</label>
                    <input type="number" class="device-quantity" id="qtdXS26" placeholder="Qtd" min="0">
                    <input type="text" class="device-observation" id="obsXS26" placeholder="Observações">
                </div>

                <div class="device-item">
                    <input type="checkbox" class="device-checkbox" id="azr31" data-device="azr31">
                    <label for="azr31" class="device-label">AZR 31 (Monitoramento de Inércia)</label>
                    <input type="number" class="device-quantity" id="qtdAZR31" placeholder="Qtd" min="0">
                    <input type="text" class="device-observation" id="obsAZR31" placeholder="Observações">
                </div>

                <div class="device-item">
                    <input type="checkbox" class="device-checkbox" id="srb301mc" data-device="srb301">
                    <label for="srb301mc" class="device-label">SRB 301MC (Relé de Emergência)</label>
                    <input type="number" class="device-quantity" id="qtdSRB301" placeholder="Qtd" min="0">
                    <input type="text" class="device-observation" id="obsSRB301" placeholder="Observações">
                </div>

                <div class="device-item">
                    <input type="checkbox" class="device-checkbox" id="srb201" data-device="srb201">
                    <label for="srb201" class="device-label">SRB 201 2HX3 (Relé de Bi-manual)</label>
                    <input type="number" class="device-quantity" id="qtdSRB201" placeholder="Qtd" min="0">
                    <input type="text" class="device-observation" id="obsSRB201" placeholder="Observações">
                </div>
            </div>
        </div>

        <!-- Seção: Dispositivos de Automação -->
        <div class="section" id="automacao">
            <h2 class="section-title">
                <span>🤖</span>
                <span>Dispositivos de Automação</span>
            </h2>

            <div class="device-group">
                <h4>🔧 Dispositivos de Automação</h4>

                <div class="device-item">
                    <input type="checkbox" class="device-checkbox" id="botaoPulso" data-device="pulso">
                    <label for="botaoPulso" class="device-label">Botão de Pulso</label>
                    <input type="number" class="device-quantity" id="qtdPulso" placeholder="Qtd" min="0">
                    <input type="text" class="device-observation" id="obsPulso" placeholder="Observações">
                </div>

                <div class="device-item">
                    <input type="checkbox" class="device-checkbox" id="pedaleiraOperacao" data-device="pedaleiraOp">
                    <label for="pedaleiraOperacao" class="device-label">Pedaleira de operação</label>
                    <input type="number" class="device-quantity" id="qtdPedaleiraOp" placeholder="Qtd" min="0">
                    <input type="text" class="device-observation" id="obsPedaleiraOp" placeholder="Observações">
                </div>

                <div class="device-item">
                    <input type="checkbox" class="device-checkbox" id="botaoDuplo" data-device="duplo">
                    <label for="botaoDuplo" class="device-label">Botão duplo Liga/Desliga</label>
                    <input type="number" class="device-quantity" id="qtdDuplo" placeholder="Qtd" min="0">
                    <input type="text" class="device-observation" id="obsDuplo" placeholder="Observações">
                </div>

                <div class="device-item">
                    <input type="checkbox" class="device-checkbox" id="seletoraChave" data-device="seletorChave">
                    <label for="seletoraChave" class="device-label">Seletora com chave</label>
                    <input type="number" class="device-quantity" id="qtdSeletorChave" placeholder="Qtd" min="0">
                    <input type="text" class="device-observation" id="obsSeletorChave" placeholder="Observações">
                </div>

                <div class="device-item">
                    <input type="checkbox" class="device-checkbox" id="seletora2pos" data-device="seletor2">
                    <label for="seletora2pos" class="device-label">Seletora 2 posições</label>
                    <input type="number" class="device-quantity" id="qtdSeletor2" placeholder="Qtd" min="0">
                    <input type="text" class="device-observation" id="obsSeletor2" placeholder="Observações">
                </div>

                <div class="device-item">
                    <input type="checkbox" class="device-checkbox" id="seletora3pos" data-device="seletor3">
                    <label for="seletora3pos" class="device-label">Seletora 3 posições</label>
                    <input type="number" class="device-quantity" id="qtdSeletor3" placeholder="Qtd" min="0">
                    <input type="text" class="device-observation" id="obsSeletor3" placeholder="Observações">
                </div>

                <div class="device-item">
                    <input type="checkbox" class="device-checkbox" id="sensorUltrassonico" data-device="ultrassonico">
                    <label for="sensorUltrassonico" class="device-label">Sensor Ultrassônico</label>
                    <input type="number" class="device-quantity" id="qtdUltrassonico" placeholder="Qtd" min="0">
                    <input type="text" class="device-observation" id="obsUltrassonico" placeholder="Observações">
                </div>

                <div class="device-item">
                    <input type="checkbox" class="device-checkbox" id="sensorLaser" data-device="laser">
                    <label for="sensorLaser" class="device-label">Sensor Laser</label>
                    <input type="number" class="device-quantity" id="qtdLaser" placeholder="Qtd" min="0">
                    <input type="text" class="device-observation" id="obsLaser" placeholder="Observações">
                </div>

                <div class="device-item">
                    <input type="checkbox" class="device-checkbox" id="sensorCapacitivo" data-device="capacitivo">
                    <label for="sensorCapacitivo" class="device-label">Sensor Capacitivo</label>
                    <input type="number" class="device-quantity" id="qtdCapacitivo" placeholder="Qtd" min="0">
                    <input type="text" class="device-observation" id="obsCapacitivo" placeholder="Observações">
                </div>

                <div class="device-item">
                    <input type="checkbox" class="device-checkbox" id="sensorFotoBarreira" data-device="fotoBarreira">
                    <label for="sensorFotoBarreira" class="device-label">Sensor Fotoelétrico Barreira</label>
                    <input type="number" class="device-quantity" id="qtdFotoBarreira" placeholder="Qtd" min="0">
                    <input type="text" class="device-observation" id="obsFotoBarreira" placeholder="Observações">
                </div>

                <div class="device-item">
                    <input type="checkbox" class="device-checkbox" id="sensorFoto" data-device="foto">
                    <label for="sensorFoto" class="device-label">Sensor Fotoelétrico</label>
                    <input type="number" class="device-quantity" id="qtdFoto" placeholder="Qtd" min="0">
                    <input type="text" class="device-observation" id="obsFoto" placeholder="Observações">
                </div>

                <div class="device-item">
                    <input type="checkbox" class="device-checkbox" id="sensorIndutivo" data-device="indutivo">
                    <label for="sensorIndutivo" class="device-label">Sensor Indutivo</label>
                    <input type="number" class="device-quantity" id="qtdIndutivo" placeholder="Qtd" min="0">
                    <input type="text" class="device-observation" id="obsIndutivo" placeholder="Observações">
                </div>

                <div class="device-item">
                    <input type="checkbox" class="device-checkbox" id="sensorRadar" data-device="radar">
                    <label for="sensorRadar" class="device-label">Sensor Radar</label>
                    <input type="number" class="device-quantity" id="qtdRadar" placeholder="Qtd" min="0">
                    <input type="text" class="device-observation" id="obsRadar" placeholder="Observações">
                </div>

                <div class="device-item">
                    <input type="checkbox" class="device-checkbox" id="colunaLuminosa" data-device="coluna">
                    <label for="colunaLuminosa" class="device-label">Coluna Luminosa (TL50/CL50)</label>
                    <input type="number" class="device-quantity" id="qtdColuna" placeholder="Qtd" min="0">
                    <input type="text" class="device-observation" id="obsColuna" placeholder="Observações">
                </div>

                <div class="device-item">
                    <input type="checkbox" class="device-checkbox" id="barreiraLuminosa" data-device="barreira">
                    <label for="barreiraLuminosa" class="device-label">Barreira Luminosa (WLS)</label>
                    <input type="number" class="device-quantity" id="qtdBarreira" placeholder="Qtd" min="0">
                    <input type="text" class="device-observation" id="obsBarreira" placeholder="Observações">
                </div>

                <div class="device-item">
                    <input type="checkbox" class="device-checkbox" id="sistemaVisao" data-device="visao">
                    <label for="sistemaVisao" class="device-label">Sistema de Visão</label>
                    <input type="number" class="device-quantity" id="qtdVisao" placeholder="Qtd" min="0">
                    <input type="text" class="device-observation" id="obsVisao" placeholder="Observações">
                </div>

                <div class="device-item">
                    <input type="checkbox" class="device-checkbox" id="clpAutomacao" data-device="clpAuto">
                    <label for="clpAutomacao" class="device-label">CLP de Automação</label>
                    <input type="number" class="device-quantity" id="qtdClpAuto" placeholder="Qtd" min="0">
                    <input type="text" class="device-observation" id="obsClpAuto" placeholder="Observações">
                </div>

                <div class="device-item">
                    <input type="checkbox" class="device-checkbox" id="remotaIO" data-device="remota">
                    <label for="remotaIO" class="device-label">Remota de I/O</label>
                    <input type="number" class="device-quantity" id="qtdRemota" placeholder="Qtd" min="0">
                    <input type="text" class="device-observation" id="obsRemota" placeholder="Observações">
                </div>

                <div class="device-item">
                    <input type="checkbox" class="device-checkbox" id="interfaceHMI" data-device="hmi">
                    <label for="interfaceHMI" class="device-label">Interface HMI</label>
                    <input type="number" class="device-quantity" id="qtdHMI" placeholder="Qtd" min="0">
                    <input type="text" class="device-observation" id="obsHMI" placeholder="Observações">
                </div>

                <div class="device-item">
                    <input type="checkbox" class="device-checkbox" id="conversorFreq" data-device="conversor">
                    <label for="conversorFreq" class="device-label">Conversor de Frequência</label>
                    <input type="number" class="device-quantity" id="qtdConversor" placeholder="Qtd" min="0">
                    <input type="text" class="device-observation" id="obsConversor" placeholder="Observações">
                </div>
            </div>
        </div>

        <!-- Preview -->
        <div class="section preview" id="preview">
            <h2>📋 FICHA TÉCNICA DE MÁQUINAS</h2>
            
            <div class="preview-section" id="previewConsultor" style="display: none;">
                <h3>👤 DADOS DO CONSULTOR</h3>
                <div class="preview-grid" id="consultorPreviewGrid"></div>
            </div>
            
            <div class="preview-section" id="previewCliente" style="display: none;">
                <h3>🏢 DADOS DO CLIENTE</h3>
                <div class="preview-grid" id="clientePreviewGrid"></div>
            </div>

            <div class="preview-section" id="previewMaquina" style="display: none;">
                <h3>⚙️ DADOS DA MÁQUINA</h3>
                <div class="preview-grid" id="maquinaPreviewGrid"></div>
            </div>

            <div class="preview-section" id="previewAcionamentos" style="display: none;">
                <h3>🔧 ACIONAMENTOS DE AUTOMAÇÃO</h3>
                <div id="acionamentosPreviewContent"></div>
            </div>

            <div class="preview-section" id="previewSeguranca" style="display: none;">
                <h3>🛡️ DISPOSITIVOS DE SEGURANÇA</h3>
                <div id="segurancaPreviewContent"></div>
            </div>

            <div class="preview-section" id="previewAutomacao" style="display: none;">
                <h3>🤖 DISPOSITIVOS DE AUTOMAÇÃO</h3>
                <div id="automacaoPreviewContent"></div>
            </div>
            
            <div class="actions">
                <button class="btn btn-secondary" onclick="window.print()">🖨️ Imprimir</button>
                <button class="btn btn-primary" onclick="generatePDF()">📄 Gerar PDF</button>
            </div>
        </div>
    </div>

    <script>
        // Estado da aplicação
        let appData = {
            consultor: {},
            cliente: {},
            maquina: {
                tipoDispositivo: [],
                tipoPainel: [],
                abordagem: []
            },
            acionamentos: {
                quantidade: 0,
                lista: []
            },
            seguranca: {
                botoes: {},
                controladores: {}
            },
            automacao: {}
        };

        let saveTimeout;
        let currentSection = 'consultor';

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            setupFormListeners();
            setupConditionalFields();
            setupAcionamentos();
            setupDevices();
            updateSaveStatus('loaded', '✅ Dados carregados');
        });

        // Navegação entre seções
        function showSection(sectionName) {
            // Remover classe active de todas as tabs e seções
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
            
            // Ativar tab e seção selecionada
            event.target.classList.add('active');
            document.getElementById(sectionName).classList.add('active');
            
            currentSection = sectionName;
            
            // Se for preview, atualizar conteúdo
            if (sectionName === 'preview') {
                updatePreview();
            }
        }

        // Setup dos listeners para auto-save
        function setupFormListeners() {
            const inputs = document.querySelectorAll('input, select, textarea');
            
            inputs.forEach(input => {
                input.addEventListener('input', function() {
                    validateField(this);
                    scheduleAutoSave();
                });
                
                input.addEventListener('change', function() {
                    validateField(this);
                    scheduleAutoSave();
                });
                
                input.addEventListener('blur', function() {
                    validateField(this);
                });
            });
        }

        // Setup dos campos condicionais
        function setupConditionalFields() {
            // Checkbox styling e funcionalidade
            setupCheckboxGroups();
            
            // Campo "Outro" para tensões
            setupOtherFields();
            
            // Campo condicional para "Outro" no tipo de painel
            setupPainelOutroField();
        }

        function setupCheckboxGroups() {
            const checkboxItems = document.querySelectorAll('.checkbox-item');
            
            checkboxItems.forEach(item => {
                const checkbox = item.querySelector('input[type="checkbox"]');
                const label = item.querySelector('label');
                
                // Sincronizar visual com estado do checkbox
                function updateVisual() {
                    if (checkbox.checked) {
                        item.classList.add('selected');
                    } else {
                        item.classList.remove('selected');
                    }
                }
                
                // Listeners para checkbox e container
                checkbox.addEventListener('change', updateVisual);
                
                item.addEventListener('click', function(e) {
                    if (e.target === item) {
                        checkbox.checked = !checkbox.checked;
                        checkbox.dispatchEvent(new Event('change'));
                        scheduleAutoSave();
                    }
                });
                
                // Estado inicial
                updateVisual();
            });
        }

        function setupOtherFields() {
            // Tensão de Entrada
            const tensaoEntrada = document.getElementById('tensaoEntrada');
            const tensaoEntradaOutro = document.getElementById('tensaoEntradaOutro');
            
            tensaoEntrada.addEventListener('change', function() {
                if (this.value === 'outro') {
                    tensaoEntradaOutro.classList.add('show');
                    tensaoEntradaOutro.focus();
                } else {
                    tensaoEntradaOutro.classList.remove('show');
                    tensaoEntradaOutro.value = '';
                }
            });

            // Tensão de Comando
            const tensaoComando = document.getElementById('tensaoComando');
            const tensaoComandoOutro = document.getElementById('tensaoComandoOutro');
            
            tensaoComando.addEventListener('change', function() {
                if (this.value === 'outro') {
                    tensaoComandoOutro.classList.add('show');
                    tensaoComandoOutro.focus();
                } else {
                    tensaoComandoOutro.classList.remove('show');
                    tensaoComandoOutro.value = '';
                }
            });
        }

        function setupPainelOutroField() {
            const painelOutroCheckbox = document.getElementById('painelOutro');
            const painelOutroField = document.getElementById('painelOutroField');
            
            painelOutroCheckbox.addEventListener('change', function() {
                if (this.checked) {
                    painelOutroField.classList.add('show');
                    document.getElementById('painelOutroTexto').focus();
                } else {
                    painelOutroField.classList.remove('show');
                    document.getElementById('painelOutroTexto').value = '';
                }
            });
        }

        // Setup dos acionamentos dinâmicos
        function setupAcionamentos() {
            const numAcionamentosSelect = document.getElementById('numAcionamentos');
            
            numAcionamentosSelect.addEventListener('change', function() {
                const quantidade = parseInt(this.value) || 0;
                generateAcionamentos(quantidade);
                scheduleAutoSave();
            });
        }

        function generateAcionamentos(quantidade) {
            const container = document.getElementById('acionamentosDynamic');
            
            if (quantidade === 0) {
                container.classList.remove('show');
                container.innerHTML = '';
                return;
            }

            container.classList.add('show');
            
            let html = '';
            for (let i = 1; i <= quantidade; i++) {
                html += `
                    <div class="acionamento-container" id="acionamento${i}">
                        <div class="acionamento-header">
                            <div class="acionamento-number">${i}</div>
                            <h3>Acionamento ${i}</h3>
                        </div>
                        
                        <div class="acionamento-grid">
                            <div class="form-group">
                                <label for="acionamento${i}Tipo">Tipo de Acionamento</label>
                                <select id="acionamento${i}Tipo" data-acionamento="${i}">
                                    <option value="">Selecione...</option>
                                    <option value="Motor">Motor</option>
                                    <option value="Hidráulico">Hidráulico (Válvula)</option>
                                    <option value="Pneumático">Pneumático (Válvula)</option>
                                </select>
                            </div>
                            
                            <div class="form-group full-width">
                                <label for="acionamento${i}Descricao">Descrição</label>
                                <input type="text" id="acionamento${i}Descricao" placeholder="Descreva a aplicação do acionamento">
                            </div>

                            <!-- Campos condicionais para Motor -->
                            <div class="conditional-motor" id="acionamento${i}Motor">
                                <div class="acionamento-grid">
                                    <div class="form-group">
                                        <label for="acionamento${i}Potencia">Potência</label>
                                        <input type="text" id="acionamento${i}Potencia" placeholder="Ex: 5 CV, 10 HP">
                                    </div>
                                    <div class="form-group">
                                        <label for="acionamento${i}TipoMotor">Tipo de Motor</label>
                                        <select id="acionamento${i}TipoMotor">
                                            <option value="">Selecione...</option>
                                            <option value="Comando">Comando</option>
                                            <option value="Inversor">Inversor</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Campos condicionais para Hidráulico/Pneumático -->
                            <div class="conditional-hydraulic" id="acionamento${i}Hydraulic">
                                <div class="form-group">
                                    <label for="acionamento${i}Diametro">Diâmetro da Mangueira</label>
                                    <input type="text" id="acionamento${i}Diametro" placeholder="Ex: 1/2 polegada">
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            container.innerHTML = html;
            
            // Setup dos listeners para os novos campos
            setupAcionamentosListeners(quantidade);
        }

        function setupAcionamentosListeners(quantidade) {
            for (let i = 1; i <= quantidade; i++) {
                const tipoSelect = document.getElementById(`acionamento${i}Tipo`);
                const motorDiv = document.getElementById(`acionamento${i}Motor`);
                const hydraulicDiv = document.getElementById(`acionamento${i}Hydraulic`);
                
                tipoSelect.addEventListener('change', function() {
                    const tipo = this.value;
                    
                    // Resetar todos os campos condicionais
                    motorDiv.classList.remove('show');
                    hydraulicDiv.classList.remove('show');
                    
                    // Limpar campos não utilizados
                    document.getElementById(`acionamento${i}Potencia`).value = '';
                    document.getElementById(`acionamento${i}TipoMotor`).value = '';
                    document.getElementById(`acionamento${i}Diametro`).value = '';
                    
                    // Mostrar campos apropriados
                    if (tipo === 'Motor') {
                        motorDiv.classList.add('show');
                    } else if (tipo === 'Hidráulico' || tipo === 'Pneumático') {
                        hydraulicDiv.classList.add('show');
                    }
                    
                    scheduleAutoSave();
                });
                
                // Listeners para auto-save em todos os campos do acionamento
                const fields = [
                    `acionamento${i}Tipo`,
                    `acionamento${i}Descricao`,
                    `acionamento${i}Potencia`,
                    `acionamento${i}TipoMotor`,
                    `acionamento${i}Diametro`
                ];
                
                fields.forEach(fieldId => {
                    const field = document.getElementById(fieldId);
                    if (field) {
                        field.addEventListener('input', scheduleAutoSave);
                        field.addEventListener('change', scheduleAutoSave);
                    }
                });
            }
        }

        // Validação de campos
        function validateField(field) {
            const value = field.value.trim();
            const fieldId = field.id;
            let isValid = true;
            let errorMessage = '';

            // Resetar estado de erro
            field.classList.remove('error');
            const errorDiv = field.nextElementSibling;
            if (errorDiv && errorDiv.classList.contains('error-message')) {
                errorDiv.style.display = 'none';
            }

            // Validações específicas
            if (field.required && !value) {
                isValid = false;
                errorMessage = 'Campo obrigatório';
            } else if (field.type === 'email' && value && !isValidEmail(value)) {
                isValid = false;
                errorMessage = 'Email inválido';
            } else if (field.type === 'tel' && value && !isValidPhone(value)) {
                isValid = false;
                errorMessage = 'Formato inválido: (00) 00000-0000';
            }

            // Aplicar formatação automática para telefone
            if (field.type === 'tel' && value) {
                field.value = formatPhone(value);
            }

            // Mostrar erro se inválido
            if (!isValid && value) {
                field.classList.add('error');
                if (errorDiv && errorDiv.classList.contains('error-message')) {
                    errorDiv.textContent = errorMessage;
                    errorDiv.style.display = 'block';
                }
            }

            return isValid;
        }

        // Utilitários de validação
        function isValidEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }

        function isValidPhone(phone) {
            const cleaned = phone.replace(/\D/g, '');
            return cleaned.length >= 10;
        }
// Adicione esta função no seu script
function setupDevices() {
    const deviceCheckboxes = document.querySelectorAll('.device-checkbox');
    
    deviceCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            const deviceItem = this.closest('.device-item');
            
            if (this.checked) {
                deviceItem.classList.add('active');
                // Focar no campo de quantidade quando ativado
                const quantityField = deviceItem.querySelector('.device-quantity');
                if (quantityField) {
                    quantityField.focus();
                }
            } else {
                deviceItem.classList.remove('active');
                // Limpar campos quando desativado
                const quantityField = deviceItem.querySelector('.device-quantity');
                const observationField = deviceItem.querySelector('.device-observation');
                
                if (quantityField) quantityField.value = '';
                if (observationField) observationField.value = '';
            }
            
            scheduleAutoSave();
        });
        
        // Inicializar estado dos checkboxes
        if (checkbox.checked) {
            checkbox.closest('.device-item').classList.add('active');
        }
    });
}
        function formatPhone(phone) {
            const cleaned = phone.replace(/\D/g, '');
            if (cleaned.length <= 2) return cleaned;
            if (cleaned.length <= 7) return cleaned.replace(/(\d{2})(\d+)/, '($1) $2');
            return cleaned.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
        }

        // Sistema de auto-save
        function scheduleAutoSave() {
            updateSaveStatus('editing', '✏️ Editando...');
            
            clearTimeout(saveTimeout);
            saveTimeout = setTimeout(() => {
                collectFormData();
                saveData();
                updateSaveStatus('saved', '✅ Salvo automaticamente');
            }, 1000);
        }

        function collectFormData() {
            // Coletar dados do consultor
            appData.consultor = {
                nome: document.getElementById('consultorNome').value.trim(),
                telefone: document.getElementById('consultorTelefone').value.trim(),
                email: document.getElementById('consultorEmail').value.trim()
            };

            // Coletar dados do cliente
            appData.cliente = {
                nome: document.getElementById('clienteNome').value.trim(),
                cidade: document.getElementById('clienteCidade').value.trim(),
                contato: document.getElementById('clienteContato').value.trim(),
                segmento: document.getElementById('clienteSegmento').value.trim(),
                telefone: document.getElementById('clienteTelefone').value.trim(),
                horario: document.getElementById('clienteHorario').value.trim(),
                email: document.getElementById('clienteEmail').value.trim(),
                turnos: document.getElementById('clienteTurnos').value
            };

            // Coletar dados da máquina
            // Nome da máquina
            appData.maquina.nome = document.getElementById('maquinaNome').value.trim();
            
            // Tipo de dispositivo (checkboxes)
            appData.maquina.tipoDispositivo = [];
            document.querySelectorAll('#tipoNovo, #tipoRetrofit, #tipoAdequacao, #tipoAutomacao').forEach(checkbox => {
                if (checkbox.checked) {
                    appData.maquina.tipoDispositivo.push(checkbox.value);
                }
            });
            
            // Tensão de entrada
            const tensaoEntradaSelect = document.getElementById('tensaoEntrada').value;
            if (tensaoEntradaSelect === 'outro') {
                appData.maquina.tensaoEntrada = document.getElementById('tensaoEntradaOutro').value.trim();
            } else {
                appData.maquina.tensaoEntrada = tensaoEntradaSelect;
            }
            
            // Outros campos simples
            appData.maquina.fase = document.getElementById('fase').value;
            appData.maquina.neutro = document.getElementById('neutro').value;
            appData.maquina.tipoControle = document.getElementById('tipoControle').value;
            
            // Tensão de comando
            const tensaoComandoSelect = document.getElementById('tensaoComando').value;
            if (tensaoComandoSelect === 'outro') {
                appData.maquina.tensaoComando = document.getElementById('tensaoComandoOutro').value.trim();
            } else {
                appData.maquina.tensaoComando = tensaoComandoSelect;
            }
            
            // Tipo de painel (checkboxes)
            appData.maquina.tipoPainel = [];
            document.querySelectorAll('#painelAco, #painelABS, #painelInox').forEach(checkbox => {
                if (checkbox.checked) {
                    appData.maquina.tipoPainel.push(checkbox.value);
                }
            });
            
            // Painel "Outro"
            if (document.getElementById('painelOutro').checked) {
                const painelOutroTexto = document.getElementById('painelOutroTexto').value.trim();
                if (painelOutroTexto) {
                    appData.maquina.tipoPainel.push(painelOutroTexto);
                }
            }
            
            // Abordagem (checkboxes)
            appData.maquina.abordagem = [];
            document.querySelectorAll('#abordagemAutomacao, #abordagemSeguranca').forEach(checkbox => {
                if (checkbox.checked) {
                    appData.maquina.abordagem.push(checkbox.value);
                }
            });

            // Coletar dados dos acionamentos
            const numAcionamentos = parseInt(document.getElementById('numAcionamentos').value) || 0;
            appData.acionamentos.quantidade = numAcionamentos;
            appData.acionamentos.lista = [];
            
            for (let i = 1; i <= numAcionamentos; i++) {
                const tipo = document.getElementById(`acionamento${i}Tipo`).value;
                const descricao = document.getElementById(`acionamento${i}Descricao`).value.trim();
                
                let acionamento = {
                    numero: i,
                    tipo: tipo,
                    descricao: descricao
                };
                
                // Campos específicos por tipo
                if (tipo === 'Motor') {
                    acionamento.potencia = document.getElementById(`acionamento${i}Potencia`).value.trim();
                    acionamento.tipoMotor = document.getElementById(`acionamento${i}TipoMotor`).value;
                } else if (tipo === 'Hidráulico' || tipo === 'Pneumático') {
                    acionamento.diametro = document.getElementById(`acionamento${i}Diametro`).value.trim();
                }
                
                // Só adicionar se tiver pelo menos o tipo preenchido
                if (tipo) {
                    appData.acionamentos.lista.push(acionamento);
                }
            }

            // Coletar dispositivos de segurança
            collectDeviceData('seguranca', 'botoes', [
                'emergencia', 'rearme', 'homemMorto', 'calco', 'bimanual', 
                'pedaleira', 'tapete', 'magnetico', 'cortina', 'chave', 'tracao', 'scanner'
            ]);
            
            collectDeviceData('seguranca', 'controladores', [
                'sc10', 'sc26', 'xs26', 'azr31', 'srb301', 'srb201'
            ]);

            // Coletar dispositivos de automação
            collectDeviceData('automacao', null, [
                'pulso', 'pedaleiraOp', 'duplo', 'seletorChave', 'seletor2', 'seletor3',
                'ultrassonico', 'laser', 'capacitivo', 'fotoBarreira', 'foto', 'indutivo',
                'radar', 'coluna', 'barreira', 'visao', 'clpAuto', 'remota', 'hmi', 'conversor'
            ]);
        }

        function collectDeviceData(section, subsection, devices) {
            const target = subsection ? appData[section][subsection] : appData[section];
            
            devices.forEach(device => {
                const checkbox = document.querySelector(`[data-device="${device}"]`);
                if (checkbox && checkbox.checked) {
                    const deviceItem = checkbox.closest('.device-item');
                    const quantity = deviceItem.querySelector('.device-quantity').value;
                    const observation = deviceItem.querySelector('.device-observation').value.trim();
                    
                    target[device] = {
                        name: deviceItem.querySelector('.device-label').textContent,
                        quantity: quantity || '1',
                        observation: observation
                    };
                }
            });
        }

        // Persistência de dados
        function saveData() {
            try {
                localStorage.setItem('fichaTecnicaData', JSON.stringify(appData));
                return true;
            } catch (e) {
                console.error('Erro ao salvar dados:', e);
                return false;
            }
        }

        function loadData() {
            try {
                const saved = localStorage.getItem('fichaTecnicaData');
                if (saved) {
                    appData = { ...appData, ...JSON.parse(saved) };
                    populateForm();
                }
            } catch (e) {
                console.error('Erro ao carregar dados:', e);
            }
        }

        function populateForm() {
            // Preencher dados do consultor
            if (appData.consultor) {
                document.getElementById('consultorNome').value = appData.consultor.nome || '';
                document.getElementById('consultorTelefone').value = appData.consultor.telefone || '';
                document.getElementById('consultorEmail').value = appData.consultor.email || '';
            }

            // Preencher dados do cliente
            if (appData.cliente) {
                document.getElementById('clienteNome').value = appData.cliente.nome || '';
                document.getElementById('clienteCidade').value = appData.cliente.cidade || '';
                document.getElementById('clienteContato').value = appData.cliente.contato || '';
                document.getElementById('clienteSegmento').value = appData.cliente.segmento || '';
                document.getElementById('clienteTelefone').value = appData.cliente.telefone || '';
                document.getElementById('clienteHorario').value = appData.cliente.horario || '';
                document.getElementById('clienteEmail').value = appData.cliente.email || '';
                document.getElementById('clienteTurnos').value = appData.cliente.turnos || '';
            }

            // Preencher dados da máquina
            if (appData.maquina) {
                document.getElementById('maquinaNome').value = appData.maquina.nome || '';
                
                // Tipo de dispositivo (checkboxes)
                if (appData.maquina.tipoDispositivo) {
                    appData.maquina.tipoDispositivo.forEach(tipo => {
                        const checkbox = document.querySelector(`input[value="${tipo}"]`);
                        if (checkbox) {
                            checkbox.checked = true;
                            checkbox.closest('.checkbox-item').classList.add('selected');
                        }
                    });
                }
                
                // Tensão de entrada
                if (appData.maquina.tensaoEntrada) {
                    const standardValues = ['110V', '220V', '380V', '440V'];
                    if (standardValues.includes(appData.maquina.tensaoEntrada)) {
                        document.getElementById('tensaoEntrada').value = appData.maquina.tensaoEntrada;
                    } else {
                        document.getElementById('tensaoEntrada').value = 'outro';
                        document.getElementById('tensaoEntradaOutro').value = appData.maquina.tensaoEntrada;
                        document.getElementById('tensaoEntradaOutro').classList.add('show');
                    }
                }
                
                // Outros campos simples
                document.getElementById('fase').value = appData.maquina.fase || '';
                document.getElementById('neutro').value = appData.maquina.neutro || '';
                document.getElementById('tipoControle').value = appData.maquina.tipoControle || '';
                
                // Tensão de comando
                if (appData.maquina.tensaoComando) {
                    const standardValues = ['24Vcc', '24Vca', '110Vca', '220Vca'];
                    if (standardValues.includes(appData.maquina.tensaoComando)) {
                        document.getElementById('tensaoComando').value = appData.maquina.tensaoComando;
                    } else {
                        document.getElementById('tensaoComando').value = 'outro';
                        document.getElementById('tensaoComandoOutro').value = appData.maquina.tensaoComando;
                        document.getElementById('tensaoComandoOutro').classList.add('show');
                    }
                }
                
                // Tipo de painel (checkboxes)
                if (appData.maquina.tipoPainel) {
                    const standardPaineis = ['Aço Carbono', 'ABS', 'Inox'];
                    appData.maquina.tipoPainel.forEach(painel => {
                        if (standardPaineis.includes(painel)) {
                            const checkbox = document.querySelector(`input[value="${painel}"]`);
                            if (checkbox) {
                                checkbox.checked = true;
                                checkbox.closest('.checkbox-item').classList.add('selected');
                            }
                        } else {
                            // É um painel "outro"
                            document.getElementById('painelOutro').checked = true;
                            document.getElementById('painelOutro').closest('.checkbox-item').classList.add('selected');
                            document.getElementById('painelOutroTexto').value = painel;
                            document.getElementById('painelOutroField').classList.add('show');
                        }
                    });
                }
                
                // Abordagem (checkboxes)
                if (appData.maquina.abordagem) {
                    appData.maquina.abordagem.forEach(abord => {
                        const checkbox = document.querySelector(`input[value="${abord}"]`);
                        if (checkbox) {
                            checkbox.checked = true;
                            checkbox.closest('.checkbox-item').classList.add('selected');
                        }
                    });
                }
            }

            // Preencher acionamentos
            if (appData.acionamentos && appData.acionamentos.quantidade > 0) {
                document.getElementById('numAcionamentos').value = appData.acionamentos.quantidade;
                generateAcionamentos(appData.acionamentos.quantidade);
                
                // Aguardar um pouco para os campos serem criados
                setTimeout(() => {
                    appData.acionamentos.lista.forEach(acionamento => {
                        const i = acionamento.numero;
                        
                        if (document.getElementById(`acionamento${i}Tipo`)) {
                            document.getElementById(`acionamento${i}Tipo`).value = acionamento.tipo || '';
                            document.getElementById(`acionamento${i}Descricao`).value = acionamento.descricao || '';
                            
                            // Campos específicos por tipo
                            if (acionamento.tipo === 'Motor') {
                                document.getElementById(`acionamento${i}Potencia`).value = acionamento.potencia || '';
                                document.getElementById(`acionamento${i}TipoMotor`).value = acionamento.tipoMotor || '';
                                document.getElementById(`acionamento${i}Motor`).classList.add('show');
                            } else if (acionamento.tipo === 'Hidráulico' || acionamento.tipo === 'Pneumático') {
                                document.getElementById(`acionamento${i}Diametro`).value = acionamento.diametro || '';
                                document.getElementById(`acionamento${i}Hydraulic`).classList.add('show');
                            }
                        }
                    });
                }, 100);
            }

            // Preencher dispositivos de segurança
            populateDevices('seguranca', 'botoes', [
                'emergencia', 'rearme', 'homemMorto', 'calco', 'bimanual', 
                'pedaleira', 'tapete', 'magnetico', 'cortina', 'chave', 'tracao', 'scanner'
            ]);
            
            populateDevices('seguranca', 'controladores', [
                'sc10', 'sc26', 'xs26', 'azr31', 'srb301', 'srb201'
            ]);

            // Preencher dispositivos de automação
            populateDevices('automacao', null, [
                'pulso', 'pedaleiraOp', 'duplo', 'seletorChave', 'seletor2', 'seletor3',
                'ultrassonico', 'laser', 'capacitivo', 'fotoBarreira', 'foto', 'indutivo',
                'radar', 'coluna', 'barreira', 'visao', 'clpAuto', 'remota', 'hmi', 'conversor'
            ]);
        }

        function populateDevices(section, subsection, devices) {
            const source = subsection ? appData[section]?.[subsection] : appData[section];
            if (!source) return;
            
            devices.forEach(device => {
                if (source[device]) {
                    const checkbox = document.querySelector(`[data-device="${device}"]`);
                    if (checkbox) {
                        checkbox.checked = true;
                        const deviceItem = checkbox.closest('.device-item');
                        deviceItem.classList.add('active');
                        deviceItem.querySelector('.device-quantity').value = source[device].quantity || '';
                        deviceItem.querySelector('.device-observation').value = source[device].observation || '';
                    }
                }
            });
        }

        function updateSaveStatus(status, message) {
            const statusElement = document.getElementById('saveStatus');
            const textElement = document.getElementById('saveText');
            
            statusElement.className = `save-status ${status}`;
            textElement.textContent = message;
        }

        // Exportar/Importar dados
        function exportData() {
            collectFormData();
            const dataStr = JSON.stringify(appData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `ficha-tecnica-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            updateSaveStatus('exported', '📤 Dados exportados');
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const importedData = JSON.parse(e.target.result);
                            appData = { ...appData, ...importedData };
                            populateForm();
                            saveData();
                            updateSaveStatus('imported', '📥 Dados importados');
                        } catch (error) {
                            alert('Erro ao importar arquivo: ' + error.message);
                        }
                    };
                    reader.readAsText(file);
                }
            };
            
            input.click();
        }

        // Atualizar preview
        function updatePreview() {
            collectFormData();
            
            // Preview Consultor
            const consultorSection = document.getElementById('previewConsultor');
            const consultorGrid = document.getElementById('consultorPreviewGrid');
            
            let consultorContent = '';
            if (appData.consultor.nome) consultorContent += `<div class="preview-label">Nome:</div><div class="preview-value">${appData.consultor.nome}</div>`;
            if (appData.consultor.telefone) consultorContent += `<div class="preview-label">Telefone:</div><div class="preview-value">${appData.consultor.telefone}</div>`;
            if (appData.consultor.email) consultorContent += `<div class="preview-label">Email:</div><div class="preview-value">${appData.consultor.email}</div>`;
            
            if (consultorContent) {
                consultorGrid.innerHTML = consultorContent;
                consultorSection.style.display = 'block';
            } else {
                consultorSection.style.display = 'none';
            }

            // Preview Cliente
            const clienteSection = document.getElementById('previewCliente');
            const clienteGrid = document.getElementById('clientePreviewGrid');
            
            let clienteContent = '';
            if (appData.cliente.nome) clienteContent += `<div class="preview-label">Empresa:</div><div class="preview-value">${appData.cliente.nome}</div>`;
            if (appData.cliente.cidade) clienteContent += `<div class="preview-label">Cidade:</div><div class="preview-value">${appData.cliente.cidade}</div>`;
            if (appData.cliente.contato) clienteContent += `<div class="preview-label">Contato Técnico:</div><div class="preview-value">${appData.cliente.contato}</div>`;
            if (appData.cliente.segmento) clienteContent += `<div class="preview-label">Segmento:</div><div class="preview-value">${appData.cliente.segmento}</div>`;
            if (appData.cliente.telefone) clienteContent += `<div class="preview-label">Telefone:</div><div class="preview-value">${appData.cliente.telefone}</div>`;
            if (appData.cliente.horario) clienteContent += `<div class="preview-label">Horário:</div><div class="preview-value">${appData.cliente.horario}</div>`;
            if (appData.cliente.email) clienteContent += `<div class="preview-label">Email:</div><div class="preview-value">${appData.cliente.email}</div>`;
            if (appData.cliente.turnos) clienteContent += `<div class="preview-label">Turnos:</div><div class="preview-value">${appData.cliente.turnos} turnos</div>`;
            
            if (clienteContent) {
                clienteGrid.innerHTML = clienteContent;
                clienteSection.style.display = 'block';
            } else {
                clienteSection.style.display = 'none';
            }

            // Preview Máquina
            const maquinaSection = document.getElementById('previewMaquina');
            const maquinaGrid = document.getElementById('maquinaPreviewGrid');
            
            let maquinaContent = '';
            if (appData.maquina.nome) maquinaContent += `<div class="preview-label">Nome/TAG:</div><div class="preview-value">${appData.maquina.nome}</div>`;
            
            // Tipo de dispositivo
            if (appData.maquina.tipoDispositivo && appData.maquina.tipoDispositivo.length > 0) {
                maquinaContent += `<div class="preview-label">Tipo de Dispositivo:</div><div class="preview-value">${appData.maquina.tipoDispositivo.join(', ')}</div>`;
            }
            
            if (appData.maquina.tensaoEntrada) maquinaContent += `<div class="preview-label">Tensão de Entrada:</div><div class="preview-value">${appData.maquina.tensaoEntrada}</div>`;
            if (appData.maquina.fase) maquinaContent += `<div class="preview-label">Fase:</div><div class="preview-value">${appData.maquina.fase}</div>`;
            if (appData.maquina.neutro) maquinaContent += `<div class="preview-label">Neutro:</div><div class="preview-value">${appData.maquina.neutro}</div>`;
            if (appData.maquina.tensaoComando) maquinaContent += `<div class="preview-label">Tensão de Comando:</div><div class="preview-value">${appData.maquina.tensaoComando}</div>`;
            if (appData.maquina.tipoControle) maquinaContent += `<div class="preview-label">Tipo de Controle:</div><div class="preview-value">${appData.maquina.tipoControle}</div>`;
            
            // Tipo de painel
            if (appData.maquina.tipoPainel && appData.maquina.tipoPainel.length > 0) {
                maquinaContent += `<div class="preview-label">Tipo de Painel:</div><div class="preview-value">${appData.maquina.tipoPainel.join(', ')}</div>`;
            }
            
            // Abordagem
            if (appData.maquina.abordagem && appData.maquina.abordagem.length > 0) {
                maquinaContent += `<div class="preview-label">Abordagem:</div><div class="preview-value">${appData.maquina.abordagem.join(', ')}</div>`;
            }
            
            if (maquinaContent) {
                maquinaGrid.innerHTML = maquinaContent;
                maquinaSection.style.display = 'block';
            } else {
                maquinaSection.style.display = 'none';
            }

            // Preview Acionamentos
            const acionamentosSection = document.getElementById('previewAcionamentos');
            const acionamentosContent = document.getElementById('acionamentosPreviewContent');
            
            if (appData.acionamentos && appData.acionamentos.lista.length > 0) {
                let acionamentosHtml = '';
                
                appData.acionamentos.lista.forEach(acionamento => {
                    acionamentosHtml += `
                        <div class="acionamento-preview-item" style="margin-bottom: 16px; padding: 12px; background: var(--bg-color); border-radius: 6px;">
                            <div style="font-weight: 600; color: var(--primary-color); margin-bottom: 8px;">
                                🔧 Acionamento ${acionamento.numero}
                            </div>
                            <div class="preview-grid">
                                <div class="preview-label">Tipo:</div>
                                <div class="preview-value">${acionamento.tipo}</div>
                    `;
                    
                    if (acionamento.descricao) {
                        acionamentosHtml += `
                                <div class="preview-label">Descrição:</div>
                                <div class="preview-value">${acionamento.descricao}</div>
                        `;
                    }
                    
                    if (acionamento.potencia) {
                        acionamentosHtml += `
                                <div class="preview-label">Potência:</div>
                                <div class="preview-value">${acionamento.potencia}</div>
                        `;
                    }
                    
                    if (acionamento.tipoMotor) {
                        acionamentosHtml += `
                                <div class="preview-label">Tipo de Motor:</div>
                                <div class="preview-value">${acionamento.tipoMotor}</div>
                        `;
                    }
                    
                    if (acionamento.diametro) {
                        acionamentosHtml += `
                                <div class="preview-label">Diâmetro:</div>
                                <div class="preview-value">${acionamento.diametro}</div>
                        `;
                    }
                    
                    acionamentosHtml += `
                            </div>
                        </div>
                    `;
                });
                
                acionamentosContent.innerHTML = acionamentosHtml;
                acionamentosSection.style.display = 'block';
                
                // Detectar se precisa forçar nova página (lógica inteligente)
                checkPageBreaks();
            } else {
                acionamentosSection.style.display = 'none';
            }

            // Preview Dispositivos de Segurança
            updateDevicesPreview('seguranca', '🛡️ DISPOSITIVOS DE SEGURANÇA', [
                { title: '🚨 Botões de Segurança', data: appData.seguranca?.botoes },
                { title: '⚡ Controladores do Sistema', data: appData.seguranca?.controladores }
            ]);

            // Preview Dispositivos de Automação
            updateDevicesPreview('automacao', '🤖 DISPOSITIVOS DE AUTOMAÇÃO', [
                { title: '🔧 Dispositivos de Automação', data: appData.automacao }
            ]);
        }

        function updateDevicesPreview(sectionId, sectionTitle, groups) {
            const section = document.getElementById(`preview${sectionId.charAt(0).toUpperCase() + sectionId.slice(1)}`);
            const content = document.getElementById(`${sectionId}PreviewContent`);
            
            let hasContent = false;
            let html = '';
            
            groups.forEach(group => {
                if (group.data && Object.keys(group.data).length > 0) {
                    hasContent = true;
                    html += `
                        <div style="margin-bottom: 20px;">
                            <h4 style="color: var(--primary-color); margin-bottom: 12px; font-size: 1.1rem;">
                                ${group.title}
                            </h4>
                            <div class="devices-preview-grid">
                    `;
                    
                    Object.values(group.data).forEach(device => {
                        html += `
                            <div class="device-preview-item">
                                <div class="preview-label">${device.name}:</div>
                                <div class="preview-value" style="text-align: center;">${device.quantity}</div>
                                <div class="preview-value">${device.observation || '-'}</div>
                            </div>
                        `;
                    });
                    
                    html += '</div></div>';
                }
            });
            
            if (hasContent) {
                content.innerHTML = html;
                section.style.display = 'block';
            } else {
                section.style.display = 'none';
            }
        }

        // Função para detectar e ajustar quebras de página
        function checkPageBreaks() {
            // Esta função pode ser expandida para detecção mais inteligente
            // Por enquanto, aplicamos as regras CSS que já fazem o trabalho
            
            // Exemplo de lógica futura: se uma seção tem mais de X acionamentos,
            // force nova página
            if (appData.acionamentos && appData.acionamentos.lista.length >= 4) {
                const acionamentosSection = document.getElementById('previewAcionamentos');
                acionamentosSection.classList.add('force-new-page');
            }
        }

        // Gerar PDF (placeholder por enquanto)
        function generatePDF() {
            alert('Funcionalidade de PDF será implementada na próxima versão!\n\nPor enquanto, use o botão "Imprimir" e salve como PDF.');
        }
    </script>
</body>
</html>